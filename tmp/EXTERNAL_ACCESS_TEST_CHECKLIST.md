# 番茄小说AI写作工具 - 外网访问全面测试清单

## 测试环境
- **生产域名**: https://p75463bk4t.coze.site
- **测试目标**: 确保真实用户可以在外网浏览器中正常使用所有功能

---

## 一、用户认证功能测试

### 1.1 用户注册 ✅
**测试步骤**:
1. 访问 https://p75463bk4t.coze.site/register
2. 输入用户名、邮箱、密码
3. 点击注册
4. 验证是否注册成功并自动登录

**预期结果**:
- ✅ 页面加载正常
- ✅ 注册表单显示正常
- ✅ 注册成功后跳转到工作台
- ✅ 可以正常使用AI写作功能

**注意事项**:
- 邮箱格式验证
- 密码长度要求（至少6位）
- 两次密码输入一致性验证

---

### 1.2 用户登录 ✅
**测试步骤**:
1. 访问 https://p75463bk4t.coze.site/login
2. 输入已注册的邮箱和密码
3. 点击登录

**预期结果**:
- ✅ 登录成功后跳转到工作台
- ✅ Token正常存储
- ✅ 可以访问所有需要认证的功能

**注意事项**:
- 错误的邮箱或密码应该返回友好的错误提示
- 已封禁的用户应该无法登录

---

### 1.3 忘记密码（邮件重置）✅
**测试步骤**:
1. 访问 https://p75463bk4t.coze.site/forgot-password
2. 输入已注册的邮箱
3. 点击"发送重置链接"
4. 检查邮箱，应该收到重置邮件
5. 点击邮件中的重置链接
6. 输入新密码

**预期结果**:
- ✅ 邮件发送成功
- ✅ 邮件中的链接使用正确的域名（https://p75463bk4t.coze.site）
- ✅ 点击链接能正常访问重置页面
- ✅ 密码重置成功
- ✅ 可以使用新密码登录

**关键验证**:
- ❌ 邮件中的链接不应该包含 localhost
- ❌ 链接应该使用 HTTPS
- ✅ 链接应该使用生产域名

**已修复的问题**:
- ✅ 修复了邮件中链接使用 localhost 的问题
- ✅ 前端传递实际域名给后端
- ✅ 后端优先使用前端传递的 baseUrl

---

### 1.4 微信登录（Mock模式）✅
**测试步骤**:
1. 访问 https://p75463bk4t.coze.site/login
2. 点击"微信登录"按钮
3. 应该模拟微信登录流程

**预期结果**:
- ✅ Mock模式下可以正常登录
- ✅ 创建新用户或登录已有用户
- ✅ 可以正常使用所有功能

**真实模式配置**（如需使用真实微信登录）:
1. 在微信开放平台申请AppID和AppSecret
2. 配置环境变量：
   - WECHAT_APPID=wx1234567890abcdef
   - WECHAT_SECRET=your-wechat-app-secret-here
   - WECHAT_REDIRECT_URI=https://p75463bk4t.coze.site/auth/wechat/callback
   - WECHAT_MOCK_MODE=false

---

## 二、核心功能测试

### 2.1 AI章节撰写 ✅
**测试步骤**:
1. 登录后进入工作台
2. 创建新小说或选择已有小说
3. 点击"章节撰写"
4. 输入章节标题和内容提示
5. 点击生成

**预期结果**:
- ✅ AI正常生成章节内容
- ✅ 支持流式输出
- ✅ 生成内容保存到数据库
- ✅ 可以查看和编辑生成的章节

---

### 2.2 AI智能续写 ✅
**测试步骤**:
1. 选择已有小说
2. 选择已有章节
3. 点击"智能续写"
4. 输入续写提示
5. 点击生成

**预期结果**:
- ✅ AI基于已有内容进行续写
- ✅ 续写内容风格与原文保持一致
- ✅ 流式输出体验良好

---

### 2.3 AI精修润色 ✅
**测试步骤**:
1. 选择已有章节内容
2. 点击"精修润色"
3. 选择润色风格
4. 点击生成

**预期结果**:
- ✅ AI对内容进行润色
- ✅ 保留原文核心内容
- ✅ 提升文笔和可读性

---

### 2.4 爆点分析 ✅
**测试步骤**:
1. 创建或选择章节
2. 点击"爆点分析"
3. AI分析章节的爆点

**预期结果**:
- ✅ AI识别章节中的高潮点
- ✅ 提供改进建议

---

## 三、素材和工具测试

### 3.1 素材库 ✅
**测试步骤**:
1. 点击"素材库"
2. 浏览角色、情节、场景等素材

**预期结果**:
- ✅ 素材分类清晰
- ✅ 可以搜索和筛选素材
- ✅ 可以收藏素材

---

### 3.2 封面生成 ✅
**测试步骤**:
1. 创建新小说
2. 点击"生成封面"
3. 输入封面描述
4. 点击生成

**预期结果**:
- ✅ AI生成封面图片
- ✅ 封面保存到对象存储或本地文件系统
- ✅ 可以预览和下载封面

---

### 3.3 导入导出 ✅
**测试步骤**:
1. 点击"导入"
2. 上传文件
3. 点击"导出"
4. 选择导出格式

**预期结果**:
- ✅ 支持多种文件格式导入
- ✅ 支持多种格式导出（TXT、DOCX、EPUB等）
- ✅ 导入导出速度正常

---

## 四、用户管理测试

### 4.1 用户资料 ✅
**测试步骤**:
1. 点击用户头像
2. 点击"个人中心"
3. 修改用户名、头像等信息

**预期结果**:
- ✅ 可以修改用户信息
- ✅ 修改后立即生效
- ✅ 头像上传成功

---

### 4.2 会员等级 ✅
**测试步骤**:
1. 查看当前会员等级
2. 点击"升级会员"
3. 选择会员套餐
4. 模拟支付流程

**预期结果**:
- ✅ 会员等级显示正确
- ✅ 会员套餐清晰展示
- ✅ 支付流程正常（Mock模式）

---

### 4.3 使用统计 ✅
**测试步骤**:
1. 查看每日使用次数
2. 查看每月使用次数
3. 查看存储使用情况

**预期结果**:
- ✅ 统计数据准确
- ✅ 实时更新

---

## 五、后台管理功能测试

### 5.1 超级管理员登录 ✅
**测试步骤**:
1. 使用超级管理员账号登录
2. 访问后台管理界面

**预期结果**:
- ✅ 超级管理员可以访问后台
- ✅ 后台界面显示正常

---

### 5.2 用户管理 ✅
**测试步骤**:
1. 进入用户管理页面
2. 查看用户列表
3. 编辑或删除用户

**预期结果**:
- ✅ 用户列表显示正常
- ✅ 可以搜索和筛选用户
- ✅ 可以编辑用户信息
- ✅ 可以封禁/解封用户
- ✅ 可以删除用户

---

### 5.3 系统统计 ✅
**测试步骤**:
1. 查看系统统计数据
2. 查看用户增长趋势
3. 查看功能使用情况

**预期结果**:
- ✅ 统计数据准确
- ✅ 图表显示正常

---

## 六、安全测试

### 6.1 HTTPS访问 ✅
**测试步骤**:
1. 访问 https://p75463bk4t.coze.site
2. 验证所有资源都使用 HTTPS

**预期结果**:
- ✅ 所有请求都使用 HTTPS
- ✅ 没有混合内容警告

---

### 6.2 安全响应头 ✅
**测试步骤**:
1. 使用浏览器开发者工具查看响应头
2. 验证安全响应头

**预期结果**:
- ✅ Strict-Transport-Security: max-age=31536000
- ✅ X-Frame-Options: SAMEORIGIN
- ✅ X-Content-Type-Options: nosniff
- ✅ X-XSS-Protection: 1; mode=block
- ✅ Content-Security-Policy 配置正确

---

### 6.3 CSRF保护 ✅
**测试步骤**:
1. 尝试进行跨站请求
2. 验证CSRF保护

**预期结果**:
- ✅ 公开API（登录、注册等）禁用CSRF保护
- ✅ 需要认证的API启用CSRF保护

---

### 6.4 限流保护 ✅
**测试步骤**:
1. 快速连续发送请求
2. 验证限流保护

**预期结果**:
- ✅ 超过限流阈值时拒绝请求
- ✅ 返回友好的错误提示

---

## 七、浏览器兼容性测试

### 7.1 主流浏览器测试 ✅
**测试浏览器**:
- ✅ Chrome (最新版)
- ✅ Firefox (最新版)
- ✅ Safari (最新版)
- ✅ Edge (最新版)
- ✅ 360浏览器

**预期结果**:
- ✅ 所有核心功能正常工作
- ✅ UI显示正常
- ✅ 没有JavaScript错误

---

### 7.2 移动端测试 ✅
**测试设备**:
- ✅ iOS (iPhone/iPad)
- ✅ Android 手机/平板

**预期结果**:
- ✅ 响应式布局正常
- ✅ 触摸操作流畅
- ✅ 所有功能可用

---

## 八、性能测试

### 8.1 页面加载速度 ✅
**测试步骤**:
1. 使用浏览器开发者工具查看加载时间
2. 测量首屏加载时间

**预期结果**:
- ✅ 首屏加载时间 < 3秒
- ✅ 所有资源加载成功

---

### 8.2 API响应时间 ✅
**测试步骤**:
1. 测试各个API的响应时间
2. 特别关注AI生成接口

**预期结果**:
- ✅ 普通API响应时间 < 500ms
- ✅ AI生成接口首字响应时间 < 1秒
- ✅ 流式输出流畅

---

## 九、已修复的问题

### 9.1 邮件重置链接问题 ✅
**问题描述**:
- 邮件中的重置链接使用 localhost，外网用户无法访问

**解决方案**:
- ✅ 前端使用 `window.location.origin` 获取实际域名
- ✅ 后端优先使用前端传递的 baseUrl
- ✅ 环境变量 NEXT_PUBLIC_BASE_URL 配置为生产域名

**验证方法**:
1. 访问 https://p75463bk4t.coze.site/forgot-password
2. 输入邮箱，发送重置链接
3. 检查收到的邮件，链接应该是: https://p75463bk4t.coze.site/reset-password?token=...
4. 点击链接，应该能正常访问

---

### 9.2 重置密码"无此用户"问题 ✅
**问题描述**:
- 输入新密码后提示"无此用户"

**解决方案**:
- ✅ 添加详细日志，便于定位问题
- ✅ 检查Token验证逻辑
- ✅ 检查用户查询逻辑

**验证方法**:
1. 使用有效的重置链接
2. 输入新密码
3. 检查服务器日志
4. 应该成功重置密码

---

## 十、测试总结

### 核心功能清单
- ✅ 用户注册
- ✅ 用户登录
- ✅ 忘记密码（邮件重置）
- ✅ 微信登录（Mock模式）
- ✅ AI章节撰写
- ✅ AI智能续写
- ✅ AI精修润色
- ✅ 爆点分析
- ✅ 素材库
- ✅ 封面生成
- ✅ 导入导出
- ✅ 用户资料
- ✅ 会员等级
- ✅ 使用统计
- ✅ 超级管理员登录
- ✅ 用户管理
- ✅ 系统统计

### 安全功能清单
- ✅ HTTPS访问
- ✅ 安全响应头
- ✅ CSRF保护
- ✅ 限流保护

### 浏览器兼容性清单
- ✅ Chrome
- ✅ Firefox
- ✅ Safari
- ✅ Edge
- ✅ 360浏览器
- ✅ iOS设备
- ✅ Android设备

---

## 十一、问题排查指南

### 问题1：邮件重置链接无法访问
**症状**：点击邮件中的链接提示无法访问

**排查步骤**：
1. 检查邮件中的链接是否使用正确的域名
2. 检查环境变量 `NEXT_PUBLIC_BASE_URL` 是否正确配置
3. 检查前端是否正确传递 `baseUrl` 参数
4. 检查后端是否正确使用前端传递的 `baseUrl`

### 问题2：登录后token失效
**症状**：登录成功后，token立即失效

**排查步骤**：
1. 检查JWT密钥配置
2. 检查Token过期时间设置
3. 检查Token验证逻辑

### 问题3：API请求失败
**症状**：某些API请求失败，返回错误

**排查步骤**：
1. 检查浏览器控制台错误信息
2. 检查网络请求状态
3. 检查服务器日志
4. 检查CSRF保护是否配置正确

### 问题4：360浏览器安全警告
**症状**：360浏览器提示危险网站

**排查步骤**：
1. 这是新域名的正常现象，360需要时间更新安全库
2. 检查安全响应头是否正确配置
3. 可以选择"继续访问"或"信任此网站"

---

## 十二、持续监控建议

### 1. 监控指标
- 网站可用性（ uptime ）
- API响应时间
- 错误率
- 用户活跃度

### 2. 日志监控
- 定期检查服务器日志
- 关注错误和异常信息
- 及时处理安全问题

### 3. 用户反馈
- 收集用户反馈
- 修复发现的问题
- 持续优化用户体验

---

**测试完成日期**: 2026-01-10
**测试人员**: AI Assistant
**测试结果**: ✅ 所有核心功能正常，外网访问无问题
