# 番茄小说AI写作工具 - 0成本部署配置完整指南

> **适合人群**：不会代码的个人开发者、学生、自媒体创作者
> **总成本**：0元（全部使用免费服务）
> **预计耗时**：2-3小时（大部分时间等待审核）

---

## 📖 目录

1. [前置准备（15分钟）](#前置准备)
2. [邮件服务配置（20分钟）](#邮件服务配置)
3. [微信登录配置（1-3天）](#微信登录配置)
4. [代码部署到Vercel（30分钟）](#代码部署到vercel)
5. [环境变量配置（15分钟）](#环境变量配置)
6. [功能测试验证（30分钟）](#功能测试验证)
7. [常见问题解答](#常见问题解答)

---

## 前置准备

### 需要准备的账号清单

| 序号 | 账号名称 | 用途 | 是否收费 | 注册地址 | 难度 |
|------|----------|------|----------|----------|------|
| 1 | GitHub账号 | 代码托管和Vercel登录 | 免费 | https://github.com | ⭐ |
| 2 | Vercel账号 | 免费部署网站 | 免费 | https://vercel.com | ⭐ |
| 3 | 163/QQ/Gmail邮箱 | 发送邮件（验证码、通知） | 免费 | 任选其一 | ⭐ |
| 4 | 微信开放平台账号 | 微信登录功能 | 免费 | https://open.weixin.qq.com | ⭐⭐⭐ |
| 5 | 豆包账号 | AI写作功能 | 免费 | https://www.doubao.com | ⭐ |

### 注册步骤详解

#### 1️⃣ 注册GitHub账号（⭐ 简单）

**步骤**：
1. 访问 https://github.com
2. 点击右上角 "Sign up"
3. 填写邮箱地址（推荐使用QQ或163邮箱）
4. 设置密码（至少15位，包含大小写字母和数字）
5. 继续完成注册流程
6. 验证邮箱（登录邮箱收到的验证邮件）

**完成后保存信息**：
```
GitHub用户名：_______________
GitHub邮箱：_______________
GitHub密码：_______________（妥善保管）
```

---

#### 2️⃣ 注册Vercel账号（⭐ 简单）

**步骤**：
1. 访问 https://vercel.com
2. 点击右上角 "Sign Up"
3. 选择 "Continue with GitHub"（推荐，省事）
4. 授权Vercel访问GitHub账号
5. 绑定手机号（用于安全验证）

**完成后保存信息**：
```
Vercel邮箱：_______________（通常是GitHub邮箱）
```

---

#### 3️⃣ 准备邮箱账号（⭐ 简单）

从以下三种邮箱中选择一种：
- 163邮箱（推荐，国内访问快）
- QQ邮箱
- Gmail（海外访问友好）

**注意**：如果你已经有这些邮箱，可以直接使用，无需重新注册。

**选择建议**：
- 如果主要用户在国内 → 选择163或QQ邮箱
- 如果有海外用户 → 选择Gmail
- 如果不确定 → 选择163邮箱（最稳定）

---

#### 4️⃣ 注册豆包账号（⭐ 简单）

**步骤**：
1. 访问 https://www.doubao.com
2. 使用手机号注册
3. 完成实名认证（可能需要）

**完成后保存信息**：
```
豆包手机号：_______________
豆包密码：_______________
```

---

#### 5️⃣ 注册微信开放平台账号（⭐⭐⭐ 中等）

**步骤**：
1. 使用微信访问 https://open.weixin.qq.com
2. 扫描页面上的二维码注册
3. 使用微信授权登录
4. 完善个人信息（姓名、身份证号）
5. 绑定银行卡（需要实名认证）

**重要提示**：
- 个人开发者可以免费注册
- 需要实名认证，但不需要付费
- 审核通过后才能创建应用

---

## 邮件服务配置

### 方案一：163邮箱（推荐，国内访问最快）

#### 获取授权码步骤（⭐ 简单）

1. **登录163邮箱**
   - 访问：https://mail.163.com
   - 使用你的163邮箱和密码登录

2. **进入设置**
   - 点击右上角 "设置" 按钮
   - 选择 "POP3/SMTP/IMAP" 选项卡

3. **开启IMAP/SMTP服务**
   - 找到 "IMAP/SMTP服务" 选项
   - 点击 "开启" 按钮
   - 系统会提示你开通该服务，点击 "确定"

4. **获取授权码**
   - 开启服务后，页面会出现 "授权码" 相关选项
   - 点击 "获取授权码" 或 "授权密码" 按钮
   - 系统会发送短信验证码到你的绑定的手机号
   - 输入短信验证码后，系统会显示授权码

5. **保存授权码**
   - 授权码是一串16位左右的字符（例如：`ABCDEF1234567890`）
   - ⚠️ **重要**：授权码只能查看一次，务必复制保存！
   - 如果忘记，需要重新生成（旧授权码会失效）

**配置信息清单**：
```
邮箱地址：your_email@163.com（替换为你的邮箱）
SMTP服务器：smtp.163.com
端口：465
安全连接：是（SSL）
授权码：_______________（刚刚获取的16位授权码，不是邮箱密码！）
```

**常见问题**：
- Q：授权码和密码有什么区别？
  A：授权码是专门用于第三方应用（如邮件客户端）发送邮件的，更安全。不能使用邮箱登录密码。

- Q：找不到"获取授权码"按钮？
  A：163邮箱界面可能更新，找找类似 "客户端授权密码"、"SMTP授权码" 等字样的按钮。

- Q：授权码可以重复使用吗？
  A：可以，同一个授权码可以长期使用，除非你重新生成新的授权码。

---

### 方案二：QQ邮箱（国内访问快）

#### 获取授权码步骤（⭐ 简单）

1. **登录QQ邮箱**
   - 访问：https://mail.qq.com
   - 使用你的QQ号和QQ邮箱密码登录

2. **进入设置**
   - 点击页面顶部的 "设置" 链接
   - 选择 "账户" 选项卡

3. **开启IMAP/SMTP服务**
   - 找到 "POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务" 部分
   - 找到 "IMAP/SMTP服务" 选项
   - 点击 "开启" 按钮

4. **验证身份**
   - 系统会要求你发送短信验证
   - 按提示发送短信到指定号码
   - 短信内容通常是：`配置邮件客户端` 发送到 `1069开头` 的号码

5. **获取授权码**
   - 验证通过后，系统会显示授权码
   - ⚠️ **重要**：授权码只能查看一次，务必复制保存！

**配置信息清单**：
```
邮箱地址：your_email@qq.com（替换为你的邮箱）
SMTP服务器：smtp.qq.com
端口：465
安全连接：是（SSL）
授权码：_______________（刚刚获取的16位授权码）
```

**常见问题**：
- Q：发送短信要收费吗？
  A：发送验证短信是免费的，不会产生费用。

- Q：授权码忘记保存了怎么办？
  A：需要重新生成授权码，但每次重新生成，旧的授权码会失效。

---

### 方案三：Gmail（海外访问友好）

#### 获取应用专用密码步骤（⭐⭐ 中等）

1. **登录Google账户**
   - 访问：https://myaccount.google.com
   - 使用你的Gmail邮箱和密码登录

2. **开启两步验证（必须！）**
   - 点击左侧 "安全性" 菜单
   - 找到 "两步验证" 选项
   - 点击 "开始" 按钮
   - 按提示完成两步验证设置（可以是手机号或验证器App）

3. **生成应用专用密码**
   - 在 "安全性" 页面找到 "应用专用密码"
   - 点击 "生成" 按钮
   - 选择 "邮件" 和 "其他（自定义名称）"
   - 在 "名称" 框中输入：`番茄小说AI`
   - 点击 "生成" 按钮

4. **复制应用专用密码**
   - 系统会显示一个16位的密码（例如：`abcd efgh ijkl mnop`）
   - ⚠️ **重要**：这个密码只能查看一次，务必复制保存！
   - 复制时不要包含空格

**配置信息清单**：
```
邮箱地址：your_email@gmail.com（替换为你的邮箱）
SMTP服务器：smtp.gmail.com
端口：587
安全连接：否（STARTTLS）
应用专用密码：_______________（16位密码，复制时不要空格）
```

**常见问题**：
- Q：为什么必须开启两步验证？
  A：Google的安全策略要求开启两步验证后才能生成应用专用密码，这是为了保护你的账户安全。

- Q：Gmail在国内能访问吗？
  A：Gmail在国内访问可能不稳定，建议使用163或QQ邮箱。

---

## 微信登录配置

### 申请微信开放平台网站应用（⭐⭐⭐ 中等）

#### 准备工作

在开始申请前，请准备好以下信息：

| 信息项 | 说明 | 示例 |
|--------|------|------|
| 网站名称 | 应用的正式名称 | 番茄小说AI写作助手 |
| 网站简介 | 简要描述应用功能 | 基于AI技术的智能小说写作辅助工具，帮助作者提升创作效率 |
| 网站域名 | 你在Vercel部署后的域名 | `tomato-ai-writer.vercel.app` 或你的自定义域名 |
| 网站图标 | 应用图标（108x108像素） | 提前准备一张正方形图片 |

**注意**：如果还没有部署到Vercel，可以暂时使用 `tomato-ai-writer.vercel.app` 作为域名，部署后再在微信开放平台更新域名。

---

#### 申请步骤详解

##### 步骤1：登录微信开放平台

1. 访问 https://open.weixin.qq.com
2. 使用微信扫描页面上的二维码登录
3. 登录后进入首页

---

##### 步骤2：创建网站应用

1. 点击页面顶部的 "管理中心" 标签
2. 找到 "网站应用" 部分
3. 点击 "创建网站应用" 按钮

---

##### 步骤3：填写应用基本信息

**必填项**：

1. **网站名称**
   - 填写：`番茄小说AI写作助手`
   - 或者你想取的名字（建议包含"AI写作"等关键词）
   - 要求：4-30个字符，简洁明了

2. **网站简介**
   - 填写：`基于AI技术的智能小说写作辅助工具，提供章节撰写、精修润色、智能续写等功能，帮助小说作者提升创作效率。`
   - 或者自己写一段简短的介绍
   - 要求：10-120个字符

3. **网站域名**
   - 如果还没部署，填写：`tomato-ai-writer.vercel.app`
   - 如果已部署并绑定自定义域名，填写你的域名
   - ⚠️ **重要**：不要添加 `http://` 或 `https://` 协议前缀
   - ⚠️ **重要**：不要添加路径（如 `/login`）

4. **网站图标**
   - 上传一张正方形图片
   - 尺寸要求：108x108像素（推荐）
   - 格式：PNG、JPG、JPEG
   - 大小：不超过300KB
   - 可以自己设计，或者找设计师帮忙

5. **授权回调域**
   - 与网站域名保持一致
   - 填写：`tomato-ai-writer.vercel.app`
   - ⚠️ **重要**：不要添加协议或路径

6. **公司信息**（个人开发者）
   - 选择：`个人` 选项
   - 填写你的真实姓名
   - 填写身份证号（需要实名认证）

7. **联系方式**
   - 填写你的手机号
   - 填写你的邮箱（用于接收审核通知）

---

##### 步骤4：提交审核

1. 检查所有信息是否填写正确
2. 点击 "提交" 按钮
3. 系统会显示 "提交成功" 的提示
4. 等待微信官方审核

---

##### 步骤5：等待审核（1-3个工作日）

审核时间通常为 **1-3个工作日**，具体取决于申请量。

**审核通过后会收到**：
- 邮件通知（发送到你填写的邮箱）
- 微信公众号通知（如果你关注了微信开放平台）
- 登录微信开放平台后，应用状态变为 "已通过"

**审核未通过会**：
- 收到审核不通过的通知
- 通知中会说明原因（如：网站名称不规范、域名无法访问等）
- 根据反馈修改后重新提交

---

##### 步骤6：获取AppID和AppSecret

审核通过后：

1. 进入 "管理中心" → "网站应用"
2. 找到你创建的应用
3. 点击应用名称进入应用详情页面
4. 在页面顶部可以看到：

```
AppID：wx1234567890abcdef
AppSecret：你的AppSecret（点击"查看"按钮后显示）
```

⚠️ **重要提示**：
- **AppID**：应用唯一标识，可以公开查看
- **AppSecret**：应用密钥，非常重要！
  - 只能在首次查看时看到
  - 如果忘记了，需要重置（重置后旧的会失效）
  - 不要泄露给任何人
  - 不要提交到公开的代码仓库

**保存信息**：
```
微信AppID：wx_______________（复制保存）
微信AppSecret：_______________（只显示一次，务必复制保存！）
```

---

##### 步骤7：配置授权回调域名

1. 在应用详情页面找到 "授权回调域名" 设置
2. 点击 "修改" 按钮
3. 填写你的域名（例如：`tomato-ai-writer.vercel.app`）
4. 点击 "保存"

⚠️ **重要**：
- 回调域名必须与 `WECHAT_REDIRECT_URI` 环境变量中的域名一致
- 不要添加协议前缀（`http://` 或 `https://`）
- 不要添加路径
- 如果使用Vercel默认域名，是 `your-project.vercel.app`

---

#### 常见问题解答

**Q1：个人开发者可以申请微信登录吗？**

A：可以。微信开放平台允许个人开发者申请网站应用，免费使用微信登录功能。但审核时可能会比企业开发者严格一些，建议提供清晰的网站说明和可访问的网站。

---

**Q2：审核需要多长时间？**

A：通常为1-3个工作日。如果申请量较大，可能需要更长时间。可以在微信开放平台查看审核状态。

---

**Q3：审核被拒绝了怎么办？**

A：
1. 查看拒绝原因（邮件或微信通知）
2. 根据原因修改应用信息
3. 重新提交审核
4. 常见拒绝原因：
   - 网站无法访问（确保部署到外网后申请）
   - 网站名称不规范（避免使用 "官方"、"授权" 等敏感词）
   - 网站内容不符（确保网站内容与简介一致）

---

**Q4：AppSecret忘记了怎么办？**

A：
1. 登录微信开放平台
2. 进入应用详情页面
3. 找到 "AppSecret" 设置
4. 点击 "重置" 按钮
5. 通过验证后，会显示新的AppSecret
6. 复制保存新的AppSecret
7. ⚠️ 记得更新环境变量中的 `WECHAT_SECRET`！

---

**Q5：可以用Mock模式跳过微信登录配置吗？**

A：可以！在开发测试阶段，可以将 `WECHAT_MOCK_MODE` 设置为 `true`，这样用户点击微信登录按钮后，会直接模拟登录成功，无需真实授权。但正式上线时必须关闭Mock模式（设置为 `false`）。

---

**Q6：域名还没有确定怎么办？**

A：
1. 可以先用Vercel的默认域名（如 `tomato-ai-writer.vercel.app`）申请
2. 申请后，如果更换域名，可以在微信开放平台修改
3. 或者等部署完成、确定域名后再申请微信开放平台应用

---

## 代码部署到Vercel

### 前置条件

在开始部署前，确保你已经：

- [x] 注册了GitHub账号
- [x] 注册了Vercel账号
- [x] 拥有项目代码（从开发者处获取或自己克隆）

---

### 部署步骤详解

#### 方法一：通过GitHub仓库部署（推荐）

##### 步骤1：准备代码仓库

1. 确保项目代码已经上传到GitHub仓库
2. 确认仓库包含以下文件：
   - `.coze` 配置文件
   - `vercel.json` 配置文件
   - `package.json` 文件
   - `.env.local.example` 环境变量模板

3. 如果仓库是私有的，确保Vercel有访问权限

---

##### 步骤2：连接Vercel

1. 访问 https://vercel.com
2. 登录你的账号
3. 点击页面上的 "Add New" → "Project" 按钮

---

##### 步骤3：导入GitHub仓库

1. 在 "Import Git Repository" 页面
2. Vercel会自动显示你的GitHub仓库列表
3. 找到番茄小说AI写作工具的仓库
4. 点击仓库右侧的 "Import" 按钮

如果看不到仓库：
- 点击 "Continue with GitHub" 重新授权
- 确保Vercel有访问该仓库的权限（如果是私有仓库）

---

##### 步骤4：配置项目

**项目配置页面**：

1. **Project Name（项目名称）**
   - 填写：`tomato-ai-writer`（或其他你喜欢的名字）
   - 名称只能包含小写字母、数字和连字符
   - 长度：3-30个字符

2. **Framework Preset（框架预设）**
   - 自动识别为 "Next.js"
   - 如果没有自动识别，手动选择 "Next.js"

3. **Root Directory（根目录）**
   - 保持默认：`./`
   - 如果项目在子目录，填写相对路径

4. **Build and Output Settings（构建设置）**
   - Build Command：`pnpm run build`（自动填充）
   - Output Directory：`.next`（自动填充）
   - Install Command：`pnpm install`（自动填充）

5. **Environment Variables（环境变量）**
   - 先点击 "Next: Deploy" 按钮
   - 我们在部署后添加环境变量（下一节详细说明）

---

##### 步骤5：开始部署

1. 点击页面底部的 "Deploy" 按钮
2. Vercel会开始构建项目
3. 构建过程可能需要 **2-5分钟**
4. 构建成功后，会显示部署成功页面
5. 页面会显示你的网站地址：
   ```
   https://tomato-ai-writer.vercel.app
   ```
6. 保存这个地址，后面配置会用到！

---

##### 步骤6：查看部署状态

- 部署页面会实时显示构建日志
- 如果构建失败，查看错误信息并修复
- 可以点击 "Redeploy" 重新部署

---

#### 方法二：通过Vercel CLI部署（适合开发者）

如果你熟悉命令行操作，可以使用Vercel CLI：

```bash
# 安装Vercel CLI
npm install -g vercel

# 登录Vercel
vercel login

# 部署项目
vercel --prod
```

---

### 部署后验证

部署成功后：

1. 点击Vercel提供的访问地址
2. 确认页面能够正常加载
3. 检查控制台是否有错误

如果页面无法访问：
- 等待1-2分钟（DNS可能需要时间生效）
- 检查域名是否正确
- 查看Vercel部署日志

---

## 环境变量配置

### 什么是环境变量？

环境变量是存储配置信息的安全方式，不会暴露在代码中。

### 必须配置的环境变量清单

以下是部署到Vercel后必须配置的环境变量：

| 序号 | 变量名 | 说明 | 示例值 | 是否必填 |
|------|--------|------|--------|----------|
| 1 | NEXT_PUBLIC_APP_NAME | 应用名称 | 番茄小说AI写作助手 | ✅ |
| 2 | NEXT_PUBLIC_BASE_URL | 应用域名 | https://tomato-ai-writer.vercel.app | ✅ |
| 3 | NODE_ENV | 运行环境 | production | ✅ |
| 4 | JWT_SECRET | JWT密钥 | your-super-secret-jwt-key-...（至少32字符） | ✅ |
| 5 | JWT_REFRESH_SECRET | 刷新Token密钥 | your-super-secret-refresh-key-... | ✅ |
| 6 | EMAIL_HOST | SMTP服务器 | smtp.163.com | ✅ |
| 7 | EMAIL_PORT | SMTP端口 | 465 | ✅ |
| 8 | EMAIL_SECURE | 是否使用SSL | true | ✅ |
| 9 | EMAIL_USER | 邮箱地址 | your_email@163.com | ✅ |
| 10 | EMAIL_PASS | 邮箱授权码 | your_163_authorization_code | ✅ |
| 11 | EMAIL_FROM | 发件人显示 | 番茄小说AI <your_email@163.com> | ✅ |
| 12 | EMAIL_MOCK_MODE | 是否Mock模式 | false | ✅ |
| 13 | WECHAT_APPID | 微信AppID | wx1234567890abcdef | ❌（可选） |
| 14 | WECHAT_SECRET | 微信AppSecret | your-wechat-app-secret | ❌（可选） |
| 15 | WECHAT_MOCK_MODE | 是否Mock模式 | true | ✅ |
| 16 | WECHAT_REDIRECT_URI | 微信回调地址 | https://tomato-ai-writer.vercel.app/api/auth/wechat/callback | ✅ |

---

### 在Vercel中配置环境变量

#### 步骤1：进入项目设置

1. 登录Vercel
2. 进入你的项目
3. 点击页面顶部的 "Settings" 标签

---

#### 步骤2：添加环境变量

1. 在左侧菜单中点击 "Environment Variables"
2. 点击右侧的 "Add New" 按钮
3. 逐个添加环境变量

---

#### 步骤3：填写环境变量

**第一组：应用基础配置**

```
Key: NEXT_PUBLIC_APP_NAME
Value: 番茄小说AI写作助手
Environment: Production, Preview, Development（全部勾选）
```

```
Key: NEXT_PUBLIC_BASE_URL
Value: https://tomato-ai-writer.vercel.app（替换为你的域名）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: NODE_ENV
Value: production
Environment: Production, Preview, Development（全部勾选）
```

---

**第二组：JWT密钥配置**

⚠️ **重要**：JWT密钥必须是强密码，建议至少32位，不要使用简单的密码！

```
Key: JWT_SECRET
Value: abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ（替换为随机字符串）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: JWT_REFRESH_SECRET
Value: different-secret-key-for-refresh-token-9876543210zyxwvutsrqponmlkjihgfedcba（替换为另一个随机字符串）
Environment: Production, Preview, Development（全部勾选）
```

**提示**：你可以使用在线密码生成器生成随机密钥，例如 https://randomkeygen.com/

---

**第三组：邮件服务配置**

根据你选择的邮箱服务商，填写对应的配置：

**163邮箱配置**：
```
Key: EMAIL_HOST
Value: smtp.163.com
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_PORT
Value: 465
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_SECURE
Value: true
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_USER
Value: your_email@163.com（替换为你的163邮箱）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_PASS
Value: your_163_authorization_code（替换为你的163授权码，不是邮箱密码！）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_FROM
Value: 番茄小说AI <your_email@163.com>（替换为你的邮箱）
Environment: Production, Preview, Development（全部勾选）
```

---

**QQ邮箱配置**：
```
Key: EMAIL_HOST
Value: smtp.qq.com
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_PORT
Value: 465
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_SECURE
Value: true
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_USER
Value: your_email@qq.com（替换为你的QQ邮箱）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_PASS
Value: your_qq_authorization_code（替换为你的QQ授权码）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_FROM
Value: 番茄小说AI <your_email@qq.com>（替换为你的邮箱）
Environment: Production, Preview, Development（全部勾选）
```

---

**Gmail配置**：
```
Key: EMAIL_HOST
Value: smtp.gmail.com
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_PORT
Value: 587
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_SECURE
Value: false
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_USER
Value: your_email@gmail.com（替换为你的Gmail邮箱）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_PASS
Value: your_app_specific_password（替换为你的Gmail应用专用密码，复制时不要空格）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: EMAIL_FROM
Value: 番茄小说AI <your_email@gmail.com>（替换为你的邮箱）
Environment: Production, Preview, Development（全部勾选）
```

---

**邮件Mock模式开关**：

```
Key: EMAIL_MOCK_MODE
Value: false（设置为false，启用真实邮件发送）
Environment: Production, Preview, Development（全部勾选）
```

---

**第四组：微信登录配置**

**如果已获取微信AppID和AppSecret**：

```
Key: WECHAT_APPID
Value: wx1234567890abcdef（替换为你的微信AppID）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: WECHAT_SECRET
Value: your-wechat-app-secret-here（替换为你的微信AppSecret）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: WECHAT_MOCK_MODE
Value: false（如果已获取AppID和AppSecret，设置为false）
Environment: Production, Preview, Development（全部勾选）
```

```
Key: WECHAT_REDIRECT_URI
Value: https://tomato-ai-writer.vercel.app/api/auth/wechat/callback（替换为你的域名）
Environment: Production, Preview, Development（全部勾选）
```

**如果还没有获取微信AppID和AppSecret**（使用Mock模式）：

```
Key: WECHAT_MOCK_MODE
Value: true（设置为true，使用Mock模式）
Environment: Production, Preview, Development（全部勾选）
```

其他微信相关变量（WECHAT_APPID、WECHAT_SECRET、WECHAT_REDIRECT_URI）暂时可以留空或填写任意值。

---

#### 步骤4：保存环境变量

添加完所有环境变量后：
1. 点击页面底部的 "Save" 按钮
2. 等待保存完成

---

#### 步骤5：重新部署项目

添加或修改环境变量后，需要重新部署项目：

1. 进入 "Deployments" 页面
2. 找到最新的部署记录
3. 点击右侧的 "..." 菜单
4. 选择 "Redeploy"
5. 等待重新部署完成（2-5分钟）

---

## 功能测试验证

配置完成后，需要进行功能测试，确保所有功能正常。

### 测试清单

| 序号 | 测试项 | 测试方法 | 预期结果 |
|------|--------|----------|----------|
| 1 | 网站访问 | 在浏览器打开你的域名 | 页面正常加载，无错误 |
| 2 | 用户注册 | 注册一个新账号 | 注册成功，收到验证邮件 |
| 3 | 用户登录 | 使用注册的账号登录 | 登录成功，进入工作区 |
| 4 | 邮箱验证 | 点击邮件中的验证链接 | 验证成功，账号状态更新 |
| 5 | 密码重置 | 请求密码重置邮件 | 收到重置邮件，可以重置密码 |
| 6 | 微信登录（Mock模式） | 点击微信登录按钮 | 模拟登录成功 |
| 7 | 微信登录（真实模式） | 使用微信扫码登录 | 微信授权成功，登录系统 |
| 8 | AI章节撰写 | 尝试生成一个章节 | AI生成内容正常显示 |
| 9 | AI精修润色 | 上传文本进行润色 | AI返回润色后的文本 |
| 10 | AI智能续写 | 输入上文进行续写 | AI返回续写内容 |

---

### 详细测试步骤

#### 1. 网站访问测试

1. 在浏览器地址栏输入你的域名（如：`https://tomato-ai-writer.vercel.app`）
2. 按回车键访问
3. 预期结果：
   - 页面正常加载
   - 显示番茄小说AI写作工具的首页
   - 没有控制台错误（按F12打开开发者工具查看）

**如果无法访问**：
- 等待1-2分钟（DNS可能需要时间）
- 检查域名是否正确
- 查看Vercel部署日志

---

#### 2. 用户注册测试

1. 点击页面的 "注册" 按钮
2. 填写注册信息：
   - 用户名：`testuser`
   - 邮箱：`your_email@163.com`（替换为你的测试邮箱）
   - 密码：`Test123456`（至少8位，包含字母和数字）
   - 确认密码：`Test123456`
3. 点击 "注册" 按钮
4. 预期结果：
   - 页面显示 "注册成功，请查收验证邮件"
   - 你的邮箱收到一封验证邮件

**如果注册失败**：
- 检查环境变量 `EMAIL_MOCK_MODE` 是否为 `false`
- 检查邮件服务配置是否正确（EMAIL_HOST、EMAIL_PORT、EMAIL_USER、EMAIL_PASS）
- 查看Vercel部署日志（Functions → Logs）

---

#### 3. 邮箱验证测试

1. 打开你的邮箱（163/QQ/Gmail）
2. 查找来自 "番茄小说AI" 的邮件
3. 点击邮件中的验证链接
4. 预期结果：
   - 页面跳转到登录页面
   - 显示 "邮箱验证成功"
   - 可以正常登录

**如果收不到邮件**：
- 检查邮箱的 "垃圾邮件" 文件夹
- 检查邮件服务配置（特别是EMAIL_PASS是否正确）
- 查看Vercel部署日志中的错误信息

---

#### 4. 用户登录测试

1. 在登录页面输入注册的账号和密码
2. 点击 "登录" 按钮
3. 预期结果：
   - 登录成功
   - 页面跳转到工作区
   - 显示用户信息

**如果登录失败**：
- 检查用户名和密码是否正确
- 查看Vercel部署日志
- 确认JWT_SECRET环境变量已配置

---

#### 5. 密码重置测试

1. 在登录页面点击 "忘记密码"
2. 输入注册的邮箱地址
3. 点击 "发送重置邮件"
4. 预期结果：
   - 页面显示 "重置邮件已发送"
   - 邮箱收到重置邮件
   - 点击邮件中的链接可以设置新密码

---

#### 6. 微信登录测试（Mock模式）

1. 确认 `WECHAT_MOCK_MODE` 环境变量为 `true`
2. 在登录页面点击 "微信登录" 按钮
3. 预期结果：
   - 页面显示 "微信登录（Mock模式）"
   - 自动完成登录（无需扫码）
   - 跳转到工作区

**如果Mock模式不工作**：
- 检查 `WECHAT_MOCK_MODE` 是否为 `true`
- 重新部署项目

---

#### 7. 微信登录测试（真实模式）

前提：已获取微信AppID和AppSecret，并配置环境变量。

1. 确认 `WECHAT_MOCK_MODE` 环境变量为 `false`
2. 确认 `WECHAT_REDIRECT_URI` 与微信开放平台配置的回调域名一致
3. 在登录页面点击 "微信登录" 按钮
4. 使用微信扫描页面上的二维码
5. 在手机上确认授权
6. 预期结果：
   - 授权成功
   - 页面跳转到工作区
   - 显示用户信息

**如果微信登录失败**：
- 检查 `WECHAT_APPID` 和 `WECHAT_SECRET` 是否正确
- 检查 `WECHAT_REDIRECT_URI` 是否与微信开放平台配置一致
- 确认回调域名已在微信开放平台配置
- 查看Vercel部署日志

---

#### 8. AI章节撰写测试

1. 登录后进入 "章节撰写" 页面
2. 填写章节信息：
   - 小说题材：玄幻
   - 章节标题：第一章
   - 情节概述：主角获得神秘传承
3. 点击 "开始生成" 按钮
4. 预期结果：
   - AI开始生成内容（流式输出）
   - 显示生成进度
   - 最终显示完整的章节内容

**如果AI生成失败**：
- 检查豆包集成服务是否正常
- 查看Vercel部署日志中的错误信息

---

#### 9. AI精修润色测试

1. 进入 "精修润色" 页面
2. 输入一段文本：
   ```
   这是一个测试文本，它有些简短。需要AI帮忙润色一下。
   ```
3. 点击 "开始润色" 按钮
4. 预期结果：
   - AI返回润色后的文本
   - 文本更加流畅、有文采

---

#### 10. AI智能续写测试

1. 进入 "智能续写" 页面
2. 输入上文：
   ```
   张三走进山洞，突然发现洞口有一块发光的石头...
   ```
3. 点击 "开始续写" 按钮
4. 预期结果：
   - AI返回续写内容
   - 内容与上文连贯、有逻辑

---

### 测试失败排查方法

如果某个功能测试失败，按以下步骤排查：

1. **查看Vercel部署日志**
   - 进入项目 → Deployments → 点击部署记录 → Functions → Logs
   - 查看是否有错误信息
   - 常见错误：环境变量未配置、API调用失败、数据库连接失败

2. **检查环境变量**
   - 进入项目 → Settings → Environment Variables
   - 确认所有必需的环境变量都已配置
   - 确认值是否正确

3. **重新部署项目**
   - 修改配置后，需要重新部署项目
   - 进入 Deployments → 选择最新部署 → "..." → Redeploy

4. **查看浏览器控制台**
   - 按F12打开开发者工具
   - 查看Console标签页
   - 查看Network标签页的请求状态

5. **联系开发者**
   - 如果以上方法都无法解决，联系项目开发者
   - 提供详细的错误信息和日志

---

## 常见问题解答

### 通用问题

**Q1：整个部署过程需要多长时间？**

A：
- 账号注册：30分钟
- 邮件服务配置：20分钟
- 微信登录配置：1-3天（主要是审核时间）
- 代码部署：30分钟
- 环境变量配置：15分钟
- 功能测试：30分钟

总计：2小时 - 3天（取决于微信审核时间）

---

**Q2：整个流程需要花钱吗？**

A：不需要！所有服务都是免费的：
- GitHub：免费
- Vercel：免费（Hobby套餐足够使用）
- 邮箱：免费（163/QQ/Gmail都是免费邮箱）
- 微信开放平台：免费（个人开发者免费申请）
- 豆包AI：免费（有免费额度）

总成本：0元

---

**Q3：我完全不懂代码，能完成部署吗？**

A：完全可以！本指南专为不会代码的个人开发者编写，所有步骤都有详细说明，只需要按照步骤操作即可。如果遇到问题，可以随时查阅"常见问题解答"或联系开发者。

---

**Q4：可以用手机完成部署吗？**

A：建议使用电脑（PC或Mac），因为：
1. 部署到Vercel需要操作GitHub
2. 配置环境变量需要复制粘贴
3. 测试功能需要使用浏览器开发者工具（F12）

如果只有手机，可以尝试使用手机浏览器，但操作可能不太方便。

---

### 邮件服务相关问题

**Q5：我163/QQ/Gmail邮箱的授权码忘记了怎么办？**

A：
- 163邮箱：重新进入邮箱设置，再次获取授权码（旧的会失效）
- QQ邮箱：重新进入设置，重新生成授权码（旧的会失效）
- Gmail：重新进入Google账户设置，重新生成应用专用密码（旧的会失效）

⚠️ 重新生成后，记得更新Vercel中的 `EMAIL_PASS` 环境变量！

---

**Q6：邮件发送很慢，怎么办？**

A：
- 163/QQ邮箱：国内发送通常很快（1-5秒）
- Gmail：国内发送可能较慢（10-30秒），建议使用163或QQ邮箱
- 如果使用Mock模式（`EMAIL_MOCK_MODE=true`），邮件不会实际发送，只会在日志中记录

---

**Q7：收不到验证邮件怎么办？**

A：
1. 检查邮箱的"垃圾邮件"文件夹
2. 检查Vercel部署日志中的错误信息
3. 确认 `EMAIL_PASS` 环境变量是否正确（是授权码，不是邮箱密码）
4. 确认 `EMAIL_MOCK_MODE` 是否为 `false`

---

### 微信登录相关问题

**Q8：微信登录审核需要多长时间？**

A：通常为1-3个工作日，具体取决于申请量。可以在微信开放平台查看审核状态。

---

**Q9：微信登录审核被拒绝了怎么办？**

A：
1. 查看拒绝原因（邮件或微信通知）
2. 常见拒绝原因：
   - 网站无法访问（确保已部署到外网）
   - 网站名称不规范（避免使用"官方"、"授权"等敏感词）
   - 网站内容不符（确保网站内容与简介一致）
3. 根据原因修改应用信息
4. 重新提交审核

---

**Q10：可以先用Mock模式，等审核通过再切换吗？**

A：可以！
1. 先设置 `WECHAT_MOCK_MODE=true`，使用Mock模式上线
2. 等微信审核通过后，获取 `WECHAT_APPID` 和 `WECHAT_SECRET`
3. 在Vercel中更新环境变量：
   - 添加 `WECHAT_APPID` 和 `WECHAT_SECRET`
   - 将 `WECHAT_MOCK_MODE` 改为 `false`
4. 重新部署项目
5. 通知用户微信登录功能已上线

---

**Q11：微信登录回调地址填错了怎么办？**

A：
1. 登录微信开放平台
2. 进入应用详情页面
3. 找到"授权回调域名"设置
4. 点击"修改"按钮
5. 填写正确的域名
6. 点击"保存"
7. 记得同时更新Vercel中的 `WECHAT_REDIRECT_URI` 环境变量

---

### Vercel部署相关问题

**Q12：Vercel部署失败，怎么排查？**

A：
1. 查看Vercel部署日志（Deployments → 点击部署记录）
2. 常见错误原因：
   - 环境变量未配置
   - 代码有语法错误
   - 依赖安装失败
3. 根据错误信息修复问题
4. 重新部署

---

**Q13：Vercel的默认域名可以更换吗？**

A：
- Vercel默认域名：`your-project.vercel.app`，无法更换
- 如果需要自定义域名（如 `www.yourdomain.com`），需要：
  1. 购买域名（可以在阿里云、腾讯云等购买）
  2. 在Vercel中添加域名
  3. 配置DNS解析

**注意**：使用自定义域名可能产生费用（域名购买费用，约10-50元/年）。

---

**Q14：Vercel的免费套餐有限制吗？**

A：Vercel免费套餐（Hobby）的限制：
- 每月100GB带宽
- 每月500次构建
- 无限部署到生产环境
- 函数执行时间：10秒（Hobby套餐）
- 团队成员：1人

对于个人开发者和小型项目，免费套餐完全够用。

---

### 环境变量相关问题

**Q15：环境变量配置后，需要重新部署吗？**

A：是的！添加或修改环境变量后，必须重新部署项目：
1. 进入 Deployments
2. 选择最新部署记录
3. 点击 "..." → "Redeploy"

---

**Q16：JWT密钥忘记了怎么办？**

A：
- 如果忘记了自己设置的 `JWT_SECRET` 或 `JWT_REFRESH_SECRET`：
- 可以重新设置一个新的随机密钥
- 在Vercel中更新环境变量
- 重新部署项目

⚠️ 注意：更新JWT密钥后，所有已登录用户会被强制退出，需要重新登录。

---

**Q17：为什么有些环境变量要同时勾选Production、Preview、Development？**

A：
- **Production**：生产环境（正式上线后的环境）
- **Preview**：预览环境（每次Git提交后自动部署的预览版本）
- **Development**：开发环境（本地开发环境）

建议全部勾选，确保所有环境都能正常使用。

---

### AI功能相关问题

**Q18：AI生成的内容质量不好怎么办？**

A：
1. 检查输入的提示词是否清晰、具体
2. 尝试使用不同的AI模型（如果有多个模型可选）
3. 重新生成（AI生成结果是随机的，可能需要多次尝试）
4. 参考项目中的"提示词库"，学习如何写好提示词

---

**Q19：AI生成速度很慢怎么办？**

A：
- AI生成速度取决于豆包服务器的响应速度
- 正常情况下，首字响应时间应在1秒内
- 如果速度明显较慢（>5秒），可能是豆包服务器繁忙
- 建议在非高峰时段使用（如早上、晚上）

---

**Q20：AI生成过程中报错了怎么办？**

A：
1. 查看Vercel部署日志中的错误信息
2. 常见错误：
   - 豆包API调用失败（可能是服务器繁忙或配置错误）
   - 输入内容过长
   - 超出免费额度
3. 根据错误信息排查问题
4. 如果是豆包服务问题，稍后再试

---

### 其他问题

**Q21：如何联系开发者获取帮助？**

A：
1. 在GitHub仓库提交Issue（最推荐）
2. 在项目的QQ群/微信群提问
3. 发邮件给项目维护者

提问时请提供：
- 具体的错误信息
- Vercel部署日志
- 浏览器控制台日志
- 你已经尝试过的解决方法

---

**Q22：项目有使用教程吗？**

A：有！项目中有详细的使用指南：
- `docs/USAGE_GUIDE.md`：完整使用教程
- `docs/API_DOCUMENTATION.md`：API文档
- `README.md`：项目介绍和快速开始

建议先阅读这些文档，再开始使用。

---

**Q23：可以商用吗？**

A：
- 本项目是开源项目，可以免费使用
- 但建议不要直接商用，因为：
  1. AI生成内容的版权问题
  2. 微信开放平台的使用条款限制
- 建议用于学习、个人创作、测试等用途

---

## 总结

通过本指南，你已经了解了：

✅ 0成本部署所需的所有服务（全部免费）
✅ 如何注册和配置各个账号
✅ 如何配置邮件服务（163/QQ/Gmail）
✅ 如何申请微信开放平台账号
✅ 如何部署到Vercel
✅ 如何配置环境变量
✅ 如何测试验证所有功能

### 快速回顾

**第一步：注册账号**（30分钟）
- [ ] 注册GitHub账号
- [ ] 注册Vercel账号
- [ ] 准备163/QQ/Gmail邮箱
- [ ] 注册豆包账号
- [ ] 注册微信开放平台账号

**第二步：配置邮件服务**（20分钟）
- [ ] 获取邮箱授权码
- [ ] 在Vercel中配置邮件环境变量

**第三步：配置微信登录**（1-3天）
- [ ] 申请微信开放平台网站应用
- [ ] 等待审核通过
- [ ] 获取AppID和AppSecret
- [ ] 在Vercel中配置微信环境变量

**第四步：部署到Vercel**（30分钟）
- [ ] 连接GitHub仓库
- [ ] 导入项目到Vercel
- [ ] 开始部署

**第五步：配置环境变量**（15分钟）
- [ ] 添加所有必需的环境变量
- [ ] 重新部署项目

**第六步：测试验证**（30分钟）
- [ ] 测试网站访问
- [ ] 测试用户注册和登录
- [ ] 测试邮件发送
- [ ] 测试微信登录
- [ ] 测试AI功能

### 获取更多帮助

- **项目文档**：查看 `docs/` 目录下的各种文档
- **GitHub Issues**：提交问题并获取帮助
- **开发者社区**：加入项目的QQ群/微信群

### 祝你使用愉快！

如果在使用过程中遇到任何问题，不要犹豫，及时查阅本指南的"常见问题解答"部分，或联系开发者获取帮助。

---

**最后更新时间**：2025年1月
**文档版本**：v1.0
**适用版本**：番茄小说AI写作工具 v1.0
