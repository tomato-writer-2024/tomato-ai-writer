# è·¨æµè§ˆå™¨ç™»å½•ç»ˆæè§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°
- âœ… Chromeæµè§ˆå™¨ï¼šæ‰‹åŠ¨è¾“å…¥ä»£ç åç™»å½•æˆåŠŸ
- âŒ Microsoft Edgeã€360ã€QQç­‰æµè§ˆå™¨ï¼šæ— æ³•ç™»å½•

## æ ¹æœ¬åŸå› 
1. Reactæ¡†æ¶åœ¨ä¸åŒæµè§ˆå™¨ä¸­çš„å…¼å®¹æ€§é—®é¢˜
2. JavaScriptæ¨¡å—å¯¼å…¥æœºåˆ¶åœ¨æŸäº›æµè§ˆå™¨ä¸­ä¸æ”¯æŒ
3. æµè§ˆå™¨å®‰å…¨è®¾ç½®æˆ–æ‰©å±•ä¿®æ”¹äº†HTTPè¯·æ±‚å¤´

## ç»ˆæè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šçº¯HTMLå¤‡ç”¨ç™»å½•é¡µé¢ï¼ˆå¼ºçƒˆæ¨èï¼‰

**è®¿é—®åœ°å€ï¼š** `http://localhost:5000/standalone-login.html`

**ç‰¹ç‚¹ï¼š**
- âœ… å®Œå…¨åŸç”ŸHTML/CSS/JavaScriptï¼Œä¸ä¾èµ–ä»»ä½•æ¡†æ¶
- âœ… é€‚ç”¨äºæ‰€æœ‰æµè§ˆå™¨ï¼ˆChromeã€Edgeã€Firefoxã€Safariã€360ã€QQã€æœç‹—ç­‰ï¼‰
- âœ… è‡ªåŠ¨å°è¯•3ç§Tokenä¼ è¾“æ–¹å¼
- âœ… æä¾›è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- âœ… æ”¯æŒä¸€é”®ç™»å½•å’Œè„šæœ¬ç”Ÿæˆä¸¤ç§æ–¹å¼

**ä½¿ç”¨æ­¥éª¤ï¼š**

1. ç›´æ¥è®¿é—® `http://localhost:5000/standalone-login.html`
2. è¾“å…¥é‚®ç®±å’Œå¯†ç ï¼š
   - é‚®ç®±ï¼š`admin@tomato-ai.com`
   - å¯†ç ï¼š`Admin@123456`
3. ç‚¹å‡»"**ğŸš€ ä¸€é”®ç™»å½•**"æŒ‰é’®
4. ç­‰å¾…è‡ªåŠ¨è·³è½¬åˆ°ç®¡ç†åå°

**å¦‚æœä¸€é”®ç™»å½•å¤±è´¥ï¼š**

1. ç‚¹å‡»"**ğŸ“ ç”Ÿæˆæ§åˆ¶å°è„šæœ¬**"æŒ‰é’®
2. å¤åˆ¶æ˜¾ç¤ºçš„è„šæœ¬
3. æŒ‰ `F12` æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
4. ç²˜è´´è„šæœ¬å¹¶æŒ‰ `Enter` æ‰§è¡Œ
5. è‡ªåŠ¨è·³è½¬åˆ°ç®¡ç†åå°

---

### æ–¹æ¡ˆäºŒï¼šç›´æ¥åœ¨æ§åˆ¶å°æ‰§è¡Œï¼ˆé€‚ç”¨äºä»»ä½•æµè§ˆå™¨ï¼‰

**æ­¥éª¤ï¼š**

1. è®¿é—®ä»»ä½•ç™»å½•é¡µé¢ï¼ˆ`http://localhost:5000/admin/login` æˆ– `http://localhost:5000/standalone-login.html`ï¼‰
2. æŒ‰ `F12` æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆConsoleæ ‡ç­¾ï¼‰
3. å¤åˆ¶ä¸‹é¢çš„ä»£ç å¹¶ç²˜è´´åˆ°æ§åˆ¶å°
4. æŒ‰ `Enter` æ‰§è¡Œ
5. è‡ªåŠ¨è·³è½¬åˆ°ç®¡ç†åå°

**è‡ªåŠ¨ç™»å½•è„šæœ¬ï¼š**

```javascript
(async function() {
    console.log('=== å¼€å§‹è‡ªåŠ¨ç™»å½• ===');

    const email = 'admin@tomato-ai.com';
    const password = 'Admin@123456';

    try {
        // æ­¥éª¤1: è°ƒç”¨ç™»å½•API
        console.log('æ­¥éª¤1: è°ƒç”¨ç™»å½•API...');
        const loginResp = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
            credentials: 'include'
        });

        const loginData = await loginResp.json();
        console.log('ç™»å½•APIå“åº”:', loginData);

        if (!loginData.success) {
            throw new Error('ç™»å½•å¤±è´¥: ' + (loginData.error || 'æœªçŸ¥é”™è¯¯'));
        }

        const token = loginData.data.token;
        console.log('âœ… Tokenè·å–æˆåŠŸï¼Œé•¿åº¦:', token.length);

        // æ­¥éª¤2: éªŒè¯è¶…çº§ç®¡ç†å‘˜æƒé™ï¼ˆå°è¯•å¤šç§æ–¹å¼ï¼‰
        console.log('æ­¥éª¤2: éªŒè¯è¶…çº§ç®¡ç†å‘˜æƒé™...');

        let verifySuccess = false;
        let verifyData = null;
        let verifyError = '';

        // æ–¹å¼1: Authorization header
        try {
            console.log('å°è¯•æ–¹å¼1: Authorization header');
            const resp1 = await fetch('/api/admin/superadmin/verify', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            });
            const data1 = await resp1.json();
            console.log('æ–¹å¼1å“åº”:', data1);
            if (data1.success) {
                verifySuccess = true;
                verifyData = data1;
                console.log('âœ… æ–¹å¼1éªŒè¯æˆåŠŸ');
            } else {
                verifyError = data1.error || 'æœªçŸ¥é”™è¯¯';
                console.log('âŒ æ–¹å¼1å¤±è´¥:', verifyError);
            }
        } catch (e) {
            console.log('âŒ æ–¹å¼1å¼‚å¸¸:', e.message);
            verifyError = e.message;
        }

        // æ–¹å¼2: X-Auth-Token header
        if (!verifySuccess) {
            try {
                console.log('å°è¯•æ–¹å¼2: X-Auth-Token header');
                const resp2 = await fetch('/api/admin/superadmin/verify', {
                    method: 'POST',
                    headers: {
                        'X-Auth-Token': token,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                const data2 = await resp2.json();
                console.log('æ–¹å¼2å“åº”:', data2);
                if (data2.success) {
                    verifySuccess = true;
                    verifyData = data2;
                    console.log('âœ… æ–¹å¼2éªŒè¯æˆåŠŸ');
                } else {
                    verifyError = data2.error || 'æœªçŸ¥é”™è¯¯';
                    console.log('âŒ æ–¹å¼2å¤±è´¥:', verifyError);
                }
            } catch (e) {
                console.log('âŒ æ–¹å¼2å¼‚å¸¸:', e.message);
                verifyError = e.message;
            }
        }

        // æ–¹å¼3: bodyå‚æ•°
        if (!verifySuccess) {
            try {
                console.log('å°è¯•æ–¹å¼3: bodyå‚æ•°');
                const resp3 = await fetch('/api/admin/superadmin/verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ token })
                });
                const data3 = await resp3.json();
                console.log('æ–¹å¼3å“åº”:', data3);
                if (data3.success) {
                    verifySuccess = true;
                    verifyData = data3;
                    console.log('âœ… æ–¹å¼3éªŒè¯æˆåŠŸ');
                } else {
                    verifyError = data3.error || 'æœªçŸ¥é”™è¯¯';
                    console.log('âŒ æ–¹å¼3å¤±è´¥:', verifyError);
                }
            } catch (e) {
                console.log('âŒ æ–¹å¼3å¼‚å¸¸:', e.message);
                verifyError = e.message;
            }
        }

        if (!verifySuccess) {
            throw new Error('æ‰€æœ‰éªŒè¯æ–¹å¼å‡å¤±è´¥: ' + verifyError);
        }

        console.log('âœ… è¶…çº§ç®¡ç†å‘˜éªŒè¯é€šè¿‡');

        // æ­¥éª¤3: ä¿å­˜token
        console.log('æ­¥éª¤3: ä¿å­˜token...');
        try {
            localStorage.setItem('admin_token', token);
            localStorage.setItem('admin_info', JSON.stringify(verifyData.admin));
            console.log('âœ… Tokenå·²ä¿å­˜åˆ°localStorage');
        } catch (e) {
            console.warn('ä¿å­˜åˆ°localStorageå¤±è´¥:', e.message);
        }

        try {
            sessionStorage.setItem('admin_token', token);
            sessionStorage.setItem('admin_info', JSON.stringify(verifyData.admin));
            console.log('âœ… Tokenå·²ä¿å­˜åˆ°sessionStorage');
        } catch (e) {
            console.warn('ä¿å­˜åˆ°sessionStorageå¤±è´¥:', e.message);
        }

        // æ­¥éª¤4: è·³è½¬
        console.log('æ­¥éª¤4: è·³è½¬åˆ°ç®¡ç†åå°...');
        setTimeout(() => {
            window.location.href = '/admin/dashboard';
        }, 500);

    } catch (e) {
        console.error('âŒ è‡ªåŠ¨ç™»å½•å¤±è´¥:', e);
        alert('ç™»å½•å¤±è´¥: ' + e.message + '\n\nè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†ä¿¡æ¯');
    }
})();
```

---

### æ–¹æ¡ˆä¸‰ï¼šæ‰‹åŠ¨åˆå§‹åŒ–è¶…çº§ç®¡ç†å‘˜

å¦‚æœä¹‹å‰çš„è¶…çº§ç®¡ç†å‘˜è´¦å·å¤±æ•ˆï¼Œå¯ä»¥é‡æ–°åˆå§‹åŒ–ï¼š

**æ­¥éª¤ï¼š**

1. è®¿é—® `http://localhost:5000/standalone-login.html`
2. ç‚¹å‡»é¡µé¢åº•éƒ¨çš„"**åˆå§‹åŒ–è¶…çº§ç®¡ç†å‘˜**"é“¾æ¥
3. æˆ–è€…åœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š

```javascript
fetch('/api/admin/superadmin/init', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        email: 'admin@tomato-ai.com',
        username: 'è¶…çº§ç®¡ç†å‘˜',
        password: 'Admin@123456'
    })
}).then(r => r.json()).then(data => {
    if (data.success) {
        alert('è¶…çº§ç®¡ç†å‘˜åˆ›å»ºæˆåŠŸï¼\né‚®ç®±: admin@tomato-ai.com\nå¯†ç : Admin@123456');
    } else {
        alert(data.error || 'åˆ›å»ºå¤±è´¥');
    }
});
```

---

## æŠ€æœ¯åŸç†

### å¤šé‡Tokenä¼ è¾“ç­–ç•¥

ç³»ç»Ÿæ”¯æŒä»3ä¸ªä½ç½®è¯»å–Tokenï¼Œç¡®ä¿å…¼å®¹æ€§ï¼š

1. **Authorization header** (Bearer token)
   ```javascript
   headers: { 'Authorization': 'Bearer ' + token }
   ```

2. **X-Auth-Token header**
   ```javascript
