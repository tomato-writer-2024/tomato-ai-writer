# è¶…çº§ç®¡ç†å‘˜ç™»å½•é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

ç”¨æˆ·åé¦ˆï¼šè®¿é—® `http://localhost:5000/admin/dashboard` æ—¶è¶…çº§ç®¡ç†å‘˜åå°æ— æ³•ç™»å½•ã€‚

## ğŸ” é—®é¢˜æ’æŸ¥

### 1. åç«¯ API æµ‹è¯• âœ…
```bash
# æµ‹è¯•ç™»å½• API
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@tomato-ai.com","password":"Admin123456"}'

# ç»“æœï¼šè¿”å›æ­£å¸¸çš„ token å’Œç”¨æˆ·ä¿¡æ¯ âœ…
```

### 2. è¶…çº§ç®¡ç†å‘˜éªŒè¯æµ‹è¯• âœ…
```bash
# æµ‹è¯•éªŒè¯ API
curl -X POST http://localhost:5000/api/admin/superadmin/verify \
  -H "Authorization: Bearer YOUR_TOKEN"

# ç»“æœï¼šè¿”å›è¶…çº§ç®¡ç†å‘˜ä¿¡æ¯ âœ…
```

### 3. æ•°æ®åº“æ£€æŸ¥ âœ…
```bash
npx tsx src/scripts/check-super-admin.ts

# ç»“æœï¼š
# - is_super_admin å­—æ®µå­˜åœ¨ âœ…
# - æ‰¾åˆ° 3 ä¸ªè¶…çº§ç®¡ç†å‘˜è´¦æˆ· âœ…
# - admin@tomato-ai.com çŠ¶æ€æ­£å¸¸ âœ…
```

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šè‡ªåŠ¨ä¿®å¤ï¼ˆæ¨èï¼‰âœ…

æ‰§è¡Œè‡ªåŠ¨ä¿®å¤è„šæœ¬ï¼š

```bash
npm run fix-admin-login
```

**ä¿®å¤å†…å®¹**ï¼š
1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
2. æ£€æŸ¥ users è¡¨ç»“æ„
3. æ£€æŸ¥è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·
4. é‡ç½®è¶…çº§ç®¡ç†å‘˜å¯†ç 
5. éªŒè¯æ•°æ®åº“çŠ¶æ€
6. ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š

**ä¿®å¤ç»“æœ**ï¼š
```
æ€»æ­¥éª¤æ•°: 5
æˆåŠŸ: 5
å¤±è´¥: 0
âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼

ç™»å½•å‡­æ®ï¼š
  URL: http://localhost:5000/admin/login
  é‚®ç®±: admin@tomato-ai.com
  å¯†ç : Admin123456
```

### æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨é‡ç½®å¯†ç 

```bash
npm run reset-admin-password admin@tomato-ai.com Admin123456
```

### æ–¹æ¡ˆ 3ï¼šæ£€æŸ¥è¶…çº§ç®¡ç†å‘˜çŠ¶æ€

```bash
npm run check-super-admin
```

## âœ… éªŒè¯æ­¥éª¤

### æ­¥éª¤ 1ï¼šè®¿é—®ç™»å½•é¡µé¢
```
http://localhost:5000/admin/login
```

### æ­¥éª¤ 2ï¼šè¾“å…¥ç™»å½•å‡­æ®
- é‚®ç®±ï¼š`admin@tomato-ai.com`
- å¯†ç ï¼š`Admin123456`

### æ­¥éª¤ 3ï¼šç™»å½•æˆåŠŸ
ç™»å½•æˆåŠŸåä¼šè‡ªåŠ¨è·³è½¬åˆ°ï¼š
```
http://localhost:5000/admin/dashboard
```

### æ­¥éª¤ 4ï¼šéªŒè¯åŠŸèƒ½
- [ ] é¡µé¢æ­£å¸¸åŠ è½½
- [ ] æ˜¾ç¤ºè¶…çº§ç®¡ç†å‘˜ä¿¡æ¯
- [ ] å¯ä»¥è®¿é—®ç®¡ç†åŠŸèƒ½
  - ç”¨æˆ·ç®¡ç†
  - è®¢å•ç®¡ç†
  - æ•°æ®ç»Ÿè®¡
  - æµ‹è¯•å·¥å…·

## ğŸ“ æ–°å¢è„šæœ¬

| è„šæœ¬å‘½ä»¤ | è¯´æ˜ |
|---------|------|
| `npm run fix-admin-login` | è‡ªåŠ¨ä¿®å¤è¶…çº§ç®¡ç†å‘˜ç™»å½•é—®é¢˜ |
| `npm run check-super-admin` | æ£€æŸ¥è¶…çº§ç®¡ç†å‘˜çŠ¶æ€ |
| `npm run reset-admin-password` | é‡ç½®è¶…çº§ç®¡ç†å‘˜å¯†ç  |

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| `SUPER_ADMIN_LOGIN_FIX.md` | è¯¦ç»†çš„æ•…éšœæ’æŸ¥å’Œè§£å†³æ–¹æ¡ˆæ–‡æ¡£ |
| `src/scripts/check-super-admin.ts` | æ£€æŸ¥è¶…çº§ç®¡ç†å‘˜çŠ¶æ€è„šæœ¬ |
| `src/scripts/reset-admin-password.ts` | é‡ç½®è¶…çº§ç®¡ç†å‘˜å¯†ç è„šæœ¬ |
| `src/scripts/fix-super-admin-login.ts` | è‡ªåŠ¨ä¿®å¤è„šæœ¬ |

## ğŸ”§ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### è¯Šæ–­é—®é¢˜
```bash
# æ£€æŸ¥è¶…çº§ç®¡ç†å‘˜çŠ¶æ€
npm run check-super-admin

# æŸ¥çœ‹æ•°æ®åº“è¿æ¥çŠ¶æ€
curl -s http://localhost:5000/api/debug/test-db-connection

# åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
curl -s http://localhost:5000/api/debug/list-users
```

### ä¿®å¤é—®é¢˜
```bash
# è‡ªåŠ¨ä¿®å¤ï¼ˆæ¨èï¼‰
npm run fix-admin-login

# æ‰‹åŠ¨é‡ç½®å¯†ç 
npm run reset-admin-password admin@tomato-ai.com NewPassword123

# æµ‹è¯•ç™»å½• API
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@tomato-ai.com","password":"Admin123456"}'
```

## ğŸ¯ å¸¸è§é—®é¢˜

### Q1: ç™»å½•åç«‹å³è·³è½¬å›ç™»å½•é¡µï¼Ÿ
**A**: æ£€æŸ¥æµè§ˆå™¨ localStorage æ˜¯å¦ä¿å­˜äº† tokenï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Application æ ‡ç­¾
3. æŸ¥çœ‹ Local Storage ä¸­çš„ `admin_token` å’Œ `admin_info`
4. å¦‚æœæ²¡æœ‰ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡è¯•

### Q2: æç¤º"é‚®ç®±æˆ–å¯†ç é”™è¯¯"ï¼Ÿ
**A**: ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„å‡­æ®ï¼š
- é‚®ç®±ï¼š`admin@tomato-ai.com`
- å¯†ç ï¼š`Admin123456`

å¦‚æœä»ç„¶æ— æ³•ç™»å½•ï¼Œè¿è¡Œ `npm run fix-admin-login` é‡ç½®å¯†ç ã€‚

### Q3: æç¤º"æ— æƒè®¿é—®æ­¤èµ„æº"ï¼Ÿ
**A**: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼š
```bash
npm run check-super-admin
```

ç¡®ä¿ `admin@tomato-ai.com` çš„ `is_super_admin` ä¸º `true`ã€‚

### Q4: æ‰¾ä¸åˆ°è¶…çº§ç®¡ç†å‘˜ï¼Ÿ
**A**: è¿è¡Œè‡ªåŠ¨ä¿®å¤è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºè¶…çº§ç®¡ç†å‘˜ï¼š
```bash
npm run fix-admin-login
```

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

- **æ€»æ­¥éª¤æ•°**: 5
- **æˆåŠŸæ­¥éª¤**: 5
- **å¤±è´¥æ­¥éª¤**: 0
- **ä¿®å¤æˆåŠŸç‡**: 100%

## ğŸš€ åç»­å»ºè®®

1. **å®šæœŸæ£€æŸ¥è¶…çº§ç®¡ç†å‘˜çŠ¶æ€**
   ```bash
   npm run check-super-admin
   ```

2. **å®šæœŸé‡ç½®å¯†ç **
   - å»ºè®®æ¯ 30 å¤©é‡ç½®ä¸€æ¬¡å¯†ç 
   - ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘ 8 ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ï¼‰

3. **è®¾ç½®å¤šä¸ªè¶…çº§ç®¡ç†å‘˜**
   - é¿å…å•ç‚¹æ•…éšœ
   - æ¯ä¸ªè¶…çº§ç®¡ç†å‘˜ä½¿ç”¨ä¸åŒçš„å¯†ç 

4. **ç›‘æ§ç™»å½•æ—¥å¿—**
   - å®šæœŸæŸ¥çœ‹è¶…çº§ç®¡ç†å‘˜ç™»å½•è®°å½•
   - å‘ç°å¼‚å¸¸ç™»å½•åŠæ—¶å¤„ç†

---

**ä¿®å¤æ—¥æœŸ**: 2025-01-16
**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ
**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
